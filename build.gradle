
buildscript {
    repositories {
        flatDir dirs: "./lib/"
    }
    dependencies {
        classpath ":proguard"
    }
}

project(":TExtract") {
  apply plugin: 'java'
  apply plugin: 'eclipse'
  apply plugin: 'idea'

  sourceCompatibility = 1.7
  version = '1.3.3'

  sourceSets.main.java.srcDirs = [ "src/" ]
  sourceSets.main.resources.srcDirs = [ "res/" ]
  sourceSets.test.java.srcDirs = [ "tests/" ]

  ext {
    mainClassName = "com.github.antag99.textract.TExtract"
  }

  repositories {
      mavenCentral()
  }

  dependencies {
      compile "commons-io:commons-io:2.4"
      compile "ar.com.hjg:pngj:2.0.1"
  }

  // Creates a fat jar containing all dependencies
  task fatJar(type: Jar) {
    manifest {
          attributes 'Implementation-Title': project.name,  
            'Implementation-Version': version,
            'Main-Class': mainClassName
      }
      // baseName = project.name
      archiveName = project.name + "Fat.jar"
      from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
      with jar
  }

  // Shrinks the fat jar using proguard
  task optimizedJar(type: proguard.gradle.ProGuardTask) {
    /*injars  "/TExtract/build/libs/TExtract.jar"
    outjars "./TExtract/build/libs/TExtract_Optimized.jar"

    libraryjars "${System.getProperty('java.home')}/lib/rt.jar"
    printmapping "TExtract/build/proguard.map"

    overloadaggressively
    repackageclasses ""
    allowaccessmodification

    keep "public class com.github.antag99.textract.TExtract { \
        public static void main(java.lang.String[]); \
    }"*/

    configuration "configuration.pro"
  }
  optimizedJar.dependsOn fatJar

  // Creates a version notice
  task createVersionFile() {
    new File("build/VERSION.txt").text = version + "\n"
  }

  build.dependsOn createVersionFile
}
